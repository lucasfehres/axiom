apiVersion: postgresql.cnpg.io/v1
kind: Cluster
metadata:
    name: jira-postgres
    namespace: atlassian
spec:
    instances: 1
    storage:
        storageClass: rook-ceph-block
        size: 1Gi

    # makes sure archives to S3 happen even if not that much data was touched in the DB
    postgresql:
        parameters:
            archive_timeout: "15m"

    plugins:
        - name: barman-cloud.cloudnative-pg.io
          isWALArchiver: true
          parameters:
              barmanObjectName: atlassian-postgres

        # - name: barman-cloud.cloudnative-pg.io
        #   isWALArchiver: false
        #   parameters:
        #       barmanObjectName: atlassian-postgres-b2
