apiVersion: cert-manager.io/v1
kind: ClusterIssuer
metadata:
    name: letsencrypt
spec:
    acme:
        server: https://acme-v02.api.letsencrypt.org/directory
        privateKeySecretRef:
            name: letsencrypt
        solvers:
            - http01:
                  gatewayHTTPRoute:
                      parentRefs:
                          - name: insecure-gateway
                            namespace: kube-system
                            kind: Gateway
            - dns01:
                  cloudflare:
                      apiTokenSecretRef:
                          # must be in the cert-manager namespace
                          name: cloudflare-api-token-secret
                          key: api-token
